{%  extends "layout.html" %}

{% block title %}transaction{% endblock %}

{% block extra_head %}
{% endblock %}

{% block content %}
{% if request.GET.check_mapping %}
    <div class="row alert alert-warning alert-dismissible fade show" role="alert">
        <div class = "col-auto">
           <i class="fa-solid fa-triangle-exclamation"></i> Please Verify<strong> File Mapping</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
{%endif%}
{% if request.GET.mapping_required %}
    <div class="row alert alert-warning alert-dismissible fade show" role="alert">
        <div class = "col-auto">
           <i class="fa-solid fa-triangle-exclamation"></i> <strong> File Mapping </strong> is required
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
{%endif%}
{% if request.GET.file_upload_success %}
    <div class="alert alert-success d-flex align-items-center alert-dismissible fade show" role="alert">
        <div class = "col-auto">
            <i class="fa-solid fa-circle-check"></i> File is Uploaded <strong>successfully</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
{%endif %}
{% if request.GET.file_upload_fail  %}
    <div class="row alert alert-warning alert-dismissible fade show" role="alert">
        <div class = "col-auto">
            <i class="fa-solid fa-circle-xmark"></i> File Upload <strong>failed</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
{%endif %}
{% if request.GET.Single_entry_success %}
    <div class="alert alert-success d-flex align-items-center alert-dismissible fade show" role="alert">
        <div class = "col-auto">
            <i class="fa-solid fa-circle-check"></i> Transaction entered <strong>successfully</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
{%endif%}
<div class='row card-container'>
    <div class = 'col-12'>
        <div class = 'card-trans-1'>
            <p class="heading" >Upload csv file</p>
            <div class="container justify-content-md-center">
                <form name="trans_entry" action={% url 'trans_page'%}  method="post" enctype="multipart/form-data" >
                    {%  csrf_token %}
                    <input type="hidden" name="input_type" value="file_upload" required>
                    <div class="row justify-content-md-center" style="padding-bottom: 5px">
                        <div class="col-lg-6 col-md-12">
                            <input class="form-control" type='file' name='file_path' id = 'file_path' accept=".csv">
                        </div>
                        <div class="col-lg-2 col-md-12 text-center" onclick="togglePopup()">
                            <button class="btn btn-primary">File Mapping</button>
                        </div>
                    </div>
                    <div class="row justify-content-md-center">
                    <div class="col-lg-2 col-md-6">
                        <label>Card type</label>
                    </div>
                    <div class="col-lg-4 col-md-6">  
                        <select id = 'card_type' name='card_type'style="width: 100%;" required> 
                            <option value=''>--Debit/Credit--</option>
                            {%for card_type in card_types %}
                                <option value = "{{card_type}}">{{card_type}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    </div>
                    <div class="row justify-content-md-center">
                    <div class="col-lg-2 col-md-6">
                        <label> Account</label>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <select id  = 'account_name' name ='account_name' style="width: 100%;" required> 
                            <option value=''>--Select Account--</option>
                            {%for account_name in account_names %}
                                <option value = "{{account_name.account_name}}">{{account_name.account_name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    </div>
                    {% comment %} <div class="row justify-content-md-center" style="padding-bottom: 5px">
                        <label style="text-align: center;">File Mapping</label>
                    </div>
                    <div class="row justify-content-md-center" style="padding-bottom: 5px">
                        <div class="col-lg-2 col-md-6 ">
                            <label>Enter name of Date Column</label>
                        </div>
                        <div class="col-lg-2 col-md-6 ">
                            <input id = 'Date_column_name' type='text' name = 'Date_column_name' style="width: 100%;" required>
                        </div>
                        <div class="col-lg-2 col-md-6 ">
                            <label>Enter name of Description Column</label>
                        </div>
                        <div class="col-lg-2 col-md-6 ">
                            <input id = 'Description_column_name' type='text' name = 'Description_column_name' style="width: 100%;" required>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <label>Enter name of Date Amount Column</label>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <input id = 'Amount_column_name' type='text' name = 'Amount_column_name' style="width: 100%;" required>
                        </div>
                    </div>    {% endcomment %}

                    <div class="text-center" style="padding-top:10px; padding-bottom: 10px" >
                        <button type = 'submit' class="btn btn-success ">Upload File</button>
                    </div>
                </form>
                
            </div>
        </div>
    </div>
</div>
    <div class="hr-with-text">
        <span id="hr-style">Or</span>
    </div>

<div class='row card-container'>
    <div class = 'col-12'>
        <div class = 'card-trans-2'>
            <p class="heading " > Enter Single Transaction</p>
            <div class="container justify-content-md-center">

                <form name="single_trans_entry" action={% url 'trans_page'%} method="post" onsubmit="validateFormSE()" enctype="multipart/form-data">
                    {%  csrf_token %}
                    <div class="row justify-content-md-center" style="padding-bottom: 5px">
                        <div class="col-lg-2 col-md-6">
                            <label>Description</label>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <input type='text' name = 'description' id = 'desc' style="width: 100%;" required>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <label>Date</label>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <input type='date' name = 'date' id = 'date' style="width: 100%;" required>
                        </div>
                    </div>
                    <div class="row justify-content-md-center" style="padding-bottom: 5px">
                        <div class="col-lg-2 col-md-6">
                            <label>Amount</label>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <input type='number' step="0.01" name = 'amount' id = 'amount' style="width: 100%;" required>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <label> Type </label>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select name='IO' id = 'IO' amountstyle="width: 100%;" required>
                                <option value=''>--income/expense--</option>
                                {%for io in ios %}
                                    <option value = "{{io}}">{{io}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row justify-content-md-center" style="padding-bottom: 5px">
                        <div class="col-lg-2 col-md-6">
                            <label>Category</label>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select id = 'category' name='category' style="width: 100%;" required>
                                <option value=''>--Select Category--</option>
                                {%for category in categories %}
                                    <option value = "{{category.categories_name}}">{{category.categories_name}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <label>Account</label>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select id = 'account_name_se' name ='account_name_se' style="width: 100%;" required>
                                <option value=''>--Select Account Name--</option>
                                {%for account_name in account_names %}
                                    <option value = "{{account_name.account_name}}">{{account_name.account_name}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                
                    <div class="text-center" style="padding-top:10px">
                        <button type = 'submit' class="btn btn-success ">Insert Single Transaction</button>
                    </div>
                    <input type="hidden" name="input_type" value="single_entry">
                </form>
            </div>
        </div>
    </div>
</div>

<div id="popupOverlay" 
    class="overlay-container">
        <div class="popup-box">
            <div class="row justify-content-md-center" style="padding-bottom: 5px">
                <label style="text-align: center;">File Mapping</label>
            </div>
        <div class="form-container" >
            <div class="row">
                <div class="col-12">
                    <select id  = 'account_name_mapping' style="width: 100%;" required> 
                            <option value=''>--Select Account--</option>
                            {%for account_name in account_names %}
                                <option value = "{{account_name.id}}">{{account_name.account_name}}</option>
                            {% endfor %}
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label>Enter name of Date Column</label>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <input id = 'Date_column_name' type='text' style="width: 100%;" required>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <label>Enter name of Description Column</label>
                </div>
            </div>
            <div class="row">
                <div class="col-12 ">
                    <input id = 'Description_column_name' type='text' style="width: 100%;" required>
                </div>
            </div>
             <div class="row">
                <div class="col-12">
                    <label>Enter name of Date Amount Column</label>
                </div>
             </div>
             <div class="row">
                <div class="col-12">
                    <input id = 'Amount_column_name' type='text'  style="width: 100%;" required>
                </div>
             </div>

            <div class="text-center" style="padding-top:10px">
                <button id='save_btn' type = 'submit' class="btn btn-success">Save</button>
            </div>
        </div>
        <div class="text-center" style="padding-top:10px" onclick="togglePopup()">
            <button class="btn btn-danger ">Close</button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}

{% load static %}  
<script src="{% static 'js/popupform.js' %}" defer></script>
<script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css" />
{% endblock %}